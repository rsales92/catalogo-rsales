<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSales Lavacar - Cat√°logo de Servi√ßos com Carrinho</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-red: #dc3545;
            --dark-red: #c82333;
            --light-grey: #f8f9fa;
            --medium-grey: #e9ecef;
            --dark-grey: #343a40;
            --black: #212529;
            --white: #ffffff;
            --blue-light: #e6f7ff;
            --blue-dark: #0056b3;
            --green: #28a745;
            --dark-green: #1e7e34;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-grey);
            color: var(--black);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 70px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
        }
        header {
            background-color: var(--black);
            color: var(--white);
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary-red);
        }
        main {
            padding: 40px 0;
            max-width: 900px;
            margin: 40px auto;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        h2 { color: var(--black); text-align: center; margin-bottom: 20px; font-weight: 700; font-size: 2em; }
        .info-text { text-align: center; margin-bottom: 30px; font-size: 1.1em; color: var(--dark-grey); padding: 10px 0; border-bottom: 1px solid var(--medium-grey); border-top: 1px solid var(--medium-grey); }
        #car-selection .button-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px; margin-bottom: 30px; }
        .car-type-btn, .back-button { background-color: var(--primary-red); color: var(--white); border: none; padding: 12px 25px; font-size: 16px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; flex: 1 1 auto; max-width: 200px; font-weight: 600; }
        .car-type-btn:hover, .back-button:hover { background-color: var(--dark-red); transform: translateY(-2px); }
        .car-type-btn.active { background-color: var(--dark-red); border: 2px solid var(--primary-red); }

        /* Servi√ßos Avulsos */
        .additional-services { padding: 0 20px; padding-top: 10px; margin-bottom: 40px; }
        .additional-services h3 { color: var(--black); font-size: 24px; margin-bottom: 15px; text-align: center; font-weight: 700; border-bottom: 2px solid var(--medium-grey); padding-bottom: 10px; }
        .service-item { background-color: var(--light-grey); border: 1px solid var(--medium-grey); border-radius: 5px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .service-item input[type="checkbox"] { min-width: 20px; height: 20px; cursor: pointer; accent-color: var(--primary-red); }
        .service-details { flex-grow: 1; }
        .service-item h4 { color: var(--primary-red); margin-top: 0; margin-bottom: 5px; font-size: 1.2em; font-weight: 600; }
        .service-item .price { font-weight: bold; color: var(--black); font-size: 1.1em; display: block; margin-top: 5px; }

        /* Estilos dos Combos (Removidos, mas mantendo classes neutras) */
        .combo-section-group { display: none; }
        .combo-section { display: none; }
        .back-button { display: block; width: fit-content; margin: 30px auto 0; }

        /* --- ESTILOS DO MODAL/POPUP CENTRALIZADA --- */
        .floating-cart-wrapper {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        #floating-cart-icon {
            background-color: var(--white);
            color: var(--primary-red);
            border: 2px solid var(--primary-red);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, transform 0.2s, color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-left: auto;
        }

        #floating-cart-icon:hover {
            background-color: var(--light-grey);
            color: var(--dark-red);
            transform: scale(1.05);
        }
        
        /* Anima√ß√£o */
        .cart-pulse {
            animation: pulse-ring 0.6s ease-out;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0px rgba(255, 0, 0, 0.7);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(255, 0, 0, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }
        }

        #cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--green);
            color: var(--white);
            font-size: 12px;
            font-weight: 700;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        /* Modal do Carrinho (Fundo Escurecido) */
        .cart-modal-overlay {
            display: none; 
            position: fixed;
            z-index: 1001; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); 
            justify-content: center;
            align-items: center;
        }

        .cart-modal-overlay.active {
            display: flex; 
        }

        /* Conte√∫do do Modal (A Popup Centralizada) */
        #cart-summary {
            background-color: var(--white);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            width: 90%; 
            max-width: 400px; 
            max-height: 90vh; 
            overflow-y: auto;
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            border-top: 4px solid var(--primary-red);
            position: relative;
        }

        .cart-modal-overlay.active #cart-summary {
            transform: scale(1);
            opacity: 1;
        }

        #cart-summary h3 { color: var(--black); font-size: 18px; margin-top: 0; margin-bottom: 10px; border-bottom: 1px dashed var(--dark-grey); padding-bottom: 5px; }
        #cart-items { list-style: none; padding: 0; margin-bottom: 15px; }
        #cart-items li { 
            font-size: 0.9em; 
            margin-bottom: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            color: var(--dark-grey); 
            border-bottom: 1px dotted var(--medium-grey);
            padding-bottom: 5px;
        }
        #cart-items li span:first-child { max-width: 60%; } 
        #cart-items li strong { color: var(--black); font-weight: 600; margin-right: 10px; }
        
        .remove-item-btn {
            background: none;
            border: none;
            color: var(--primary-red);
            cursor: pointer;
            font-size: 1.1em;
            padding: 0 5px;
            transition: color 0.2s;
            line-height: 1;
            margin-left: 5px;
        }
        .remove-item-btn:hover {
            color: var(--dark-red);
        }

        .cart-subtotal {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--dark-grey);
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-top: 1px dashed var(--medium-grey);
        }

        .cart-discount {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--green); 
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        #cart-total { 
            font-size: 1.3em; 
            font-weight: 700; 
            color: var(--black); 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-top: 2px solid var(--primary-red); 
            margin-bottom: 5px;
        }
        
        .payment-note {
            font-size: 0.9em;
            color: var(--dark-red);
            text-align: center;
            margin-bottom: 15px;
            padding: 5px;
            background-color: #ffe6e6;
            border-radius: 3px;
            border: 1px solid var(--dark-red);
        }

        .checkout-button {
            display: block;
            width: 100%;
            max-width: none;
            background-color: var(--green);
            margin-top: 15px;
            border: none;
            padding: 10px;
            color: var(--white);
            font-weight: 600;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .checkout-button:hover { background-color: var(--dark-green); }
        .checkout-button:disabled { background-color: #6c757d; cursor: not-allowed; }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-grey);
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-modal:hover {
            color: var(--primary-red);
        }

        .appointment-message {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background-color: var(--blue-light);
            border: 1px solid #b3e0ff;
            border-radius: 5px;
            font-size: 1.1em;
            color: var(--blue-dark);
        }
        .appointment-message a {
            color: var(--blue-dark);
            font-weight: bold;
            text-decoration: none;
        }
        .appointment-message a:hover {
            text-decoration: underline;
        }

        @media (max-width: 400px) {
            .floating-cart-wrapper {
                bottom: 10px;
                right: 10px;
            }
            #floating-cart-icon {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>RSales Lavacar - Cat√°logo</h1>
        </div>
    </header>
    
    <main class="container">
        <section id="car-selection">
            <p class="info-text">
                Selecione a categoria do seu ve√≠culo para visualizar os pre√ßos e servi√ßos dispon√≠veis.
            </p>
            <h2>Selecione o tipo de carro:</h2>
            <div class="button-group">
                <button class="car-type-btn" data-car="SUV">SUV</button>
                <button class="car-type-btn" data-car="Hatch">Hatch</button>
                <button class="car-type-btn" data-car="Sed√£">Sed√£</button>
                <button class="car-type-btn" data-car="Picape">Picape</button>
            </div>
        </section>

        <section id="services-display" style="display: none;">
            <h2 id="car-type-title"></h2>
            <div id="services-content">
            </div>
            
            <button id="back-to-selection" class="back-button">Voltar √† Sele√ß√£o de Carros</button>
        </section>
    </main>

    <div id="cart-modal" class="cart-modal-overlay">
        </div>

    <section class="floating-cart-wrapper">
        <div id="floating-cart-icon">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
        </div>
    </section>
    
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

    <script>
        // ESTRUTURA DE DADOS (APENAS SERVI√áOS AVULSOS)
        const carData = {
            "SUV": {
                "additional_services": [
                    {"name": "Lavagem detalhada (com aplica√ß√£o de cera)", "description": "Limpeza profunda e minuciosa, garantindo que cada canto do seu carro esteja impec√°vel.", "price": "R$ 140,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos externos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos externos (para-choques, frisos, retrovisores), com realce da cor original.", "price": "R$ 60,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos internos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos internos (painel, portas, consoles), com realce da cor original.", "price": "R$ 80,00"},
                    {"name": "Descontamina√ß√£o e prote√ß√£o dos vidros", "description": "Limpeza profunda dos vidros externos, remo√ß√£o de res√≠duos como chuva √°cida, gordura e polui√ß√£o, com aplica√ß√£o de selante hidrof√≥bico.", "price": "R$ 170,00"},
                    {"name": "Higieniza√ß√£o e hidrata√ß√£o dos bancos de couro", "description": "Limpeza e hidrata√ß√£o profunda para manter seus bancos de couro macios e livres de rachaduras.", "price": "R$ 150,00"},
                    {"name": "Polimento Comercial", "description": "Polimento da lataria, removendo manchas e riscos leves. Indicado para recuperar a cor e o brilho do carro.", "price": "R$ 560,00"},
                    {"name": "Limpeza dos far√≥is (amarelados ou opacos)", "description": "Renova o brilho e remove o amarelado dos far√≥is, melhorando a ilumina√ß√£o e a est√©tica.", "price": "R$ 60,00 cada"}
                ],
                
            },
            "Hatch": {
                "additional_services": [
                    {"name": "Lavagem detalhada (com aplica√ß√£o de cera)", "description": "Limpeza profunda e minuciosa, garantindo que cada canto do seu carro esteja impec√°vel.", "price": "R$ 110,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos externos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos externos.", "price": "R$ 40,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos internos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos internos (painel, portas, consoles).", "price": "R$ 60,00"},
                    {"name": "Descontamina√ß√£o e prote√ß√£o dos vidros", "description": "Limpeza profunda dos vidros, remo√ß√£o de chuva √°cida e aplica√ß√£o de selante hidrof√≥bico.", "price": "R$ 150,00"},
                    {"name": "Higieniza√ß√£o e hidrata√ß√£o dos bancos de couro", "description": "Limpeza e hidrata√ß√£o profunda para manter seus bancos de couro macios.", "price": "R$ 120,00"},
                    {"name": "Polimento Comercial", "description": "Polimento da lataria, removendo manchas e riscos leves e recuperando o brilho.", "price": "R$ 360,00"},
                    {"name": "Limpeza dos far√≥is (amarelados ou opacos)", "description": "Renova o brilho e remove o amarelado dos far√≥is.", "price": "R$ 60,00 cada"}
                ],
                
            },
            "Sed√£": {
                "additional_services": [
                    {"name": "Lavagem detalhada (com aplica√ß√£o de cera)", "description": "Limpeza profunda e minuciosa, garantindo que cada canto do seu carro esteja impec√°vel.", "price": "R$ 120,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos externos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos externos.", "price": "R$ 40,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos internos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos internos (painel, portas, consoles).", "price": "R$ 60,00"},
                    {"name": "Descontamina√ß√£o e prote√ß√£o dos vidros", "description": "Limpeza profunda dos vidros, remo√ß√£o de chuva √°cida e aplica√ß√£o de selante hidrof√≥bico.", "price": "R$ 150,00"},
                    {"name": "Higieniza√ß√£o e hidrata√ß√£o dos bancos de couro", "description": "Limpeza e hidrata√ß√£o profunda para manter seus bancos de couro macios.", "price": "R$ 120,00"},
                    {"name": "Polimento Comercial", "description": "Polimento da lataria, removendo manchas e riscos leves e recuperando o brilho.", "price": "R$ 460,00"},
                    {"name": "Limpeza dos far√≥is (amarelados ou opacos)", "description": "Renova o brilho e remove o amarelado dos far√≥is.", "price": "R$ 60,00 cada"}
                ],
                
            },
            "Picape": {
                "additional_services": [
                    {"name": "Lavagem detalhada (com aplica√ß√£o de cera)", "description": "Limpeza profunda e minuciosa, garantindo que cada canto do seu carro esteja impec√°vel.", "price": "R$ 160,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos externos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos externos.", "price": "R$ 40,00"},
                    {"name": "Hidrata√ß√£o dos pl√°sticos internos", "description": "Limpeza e descontamina√ß√£o dos pl√°sticos internos (painel, portas, consoles).", "price": "R$ 60,00"},
                    {"name": "Descontamina√ß√£o e prote√ß√£o dos vidros", "description": "Limpeza profunda dos vidros, remo√ß√£o de chuva √°cida e aplica√ß√£o de selante hidrof√≥bico.", "price": "R$ 150,00"},
                    {"name": "Higieniza√ß√£o e hidrata√ß√£o dos bancos de couro", "description": "Limpeza e hidrata√ß√£o profunda para manter seus bancos de couro macios.", "price": "R$ 120,00"},
                    {"name": "Polimento Comercial", "description": "Polimento da lataria, removendo manchas e riscos leves e recuperando o brilho.", "price": "R$ 660,00"},
                    {"name": "Limpeza dos far√≥is (amarelados ou opacos)", "description": "Renova o brilho e remove o amarelado dos far√≥is.", "price": "R$ 60,00 cada"}
                ],
                
            }
        };
        

        document.addEventListener('DOMContentLoaded', () => {
            const carTypeButtons = document.querySelectorAll('.car-type-btn');
            const backButton = document.getElementById('back-to-selection');
            const carSelectionSection = document.getElementById('car-selection');
            const servicesDisplaySection = document.getElementById('services-display');
            const carTypeTitle = document.getElementById('car-type-title');
            const servicesContent = document.getElementById('services-content');
            
            const floatingCartIcon = document.getElementById('floating-cart-icon');
            const cartCountSpan = document.getElementById('cart-count');
            
            const cartModalOverlay = document.getElementById('cart-modal');
            let cartItemsList;
            let cartSummaryElement; 
            let checkoutButton;

            let cart = [];
            let currentCarType = '';
            let nextItemId = 0; 

            const WHATSAPP_NUMBER = '5544997063542';
            const DISCOUNT_RATE = 0.05; // 5% de desconto
            const CREDIT_ACCRESCIMO_RATE = 0.05; // 5% de acr√©scimo no cr√©dito

            const formatPrice = (priceText) => {
                const numStr = priceText.replace('R$', '').replace(',', '.').replace('cada', '').trim();
                const match = numStr.match(/(\d+\.?\d*)/);
                return match ? parseFloat(match[0]) : 0;
            };

            const formatToBRL = (number) => {
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(number);
            };

            const animateCart = () => {
                floatingCartIcon.classList.remove('cart-pulse');
                void floatingCartIcon.offsetWidth; 
                floatingCartIcon.classList.add('cart-pulse');
            }

            const toggleFloatingCart = () => {
                if (cartModalOverlay.classList.contains('active')) {
                    cartModalOverlay.classList.remove('active');
                } else {
                    cartModalOverlay.classList.add('active');
                }
            };
            
            const createCartSummaryHTML = () => {
                const summaryHTML = `
                    <section id="cart-summary">
                        <span class="close-modal">&times;</span>
                        <h3>üõí Carrinho de Servi√ßos Avulsos</h3>
                        <ul id="cart-items">
                            <li>Nenhum servi√ßo avulso selecionado.</li>
                        </ul>
                        <div id="cart-summary-totals"> 
                        </div>
                        
                        <p class="payment-note">
                            *Acr√©scimo no valor total para pagamento com Cart√£o de Cr√©dito.
                        </p>
                        <button id="checkout-button" class="checkout-button" disabled>Agendar</button>
                    </section>
                `;
                
                cartModalOverlay.innerHTML = summaryHTML;
                
                cartItemsList = document.getElementById('cart-items');
                cartSummaryElement = document.getElementById('cart-summary-totals');
                checkoutButton = document.getElementById('checkout-button');

                checkoutButton.addEventListener('click', handleCheckout);
                document.querySelector('.close-modal').addEventListener('click', toggleFloatingCart);
                
                cartModalOverlay.addEventListener('click', (event) => {
                    if (event.target === cartModalOverlay) {
                        toggleFloatingCart();
                    }
                });
            };

            const removeItem = (itemId) => {
                const index = cart.findIndex(item => item.id === itemId);
                if (index > -1) {
                    const item = cart[index];
                    const checkbox = document.getElementById(item.checkboxId);
                    if (checkbox) {
                        checkbox.checked = false;
                        checkbox.removeAttribute('data-cart-id');
                    }
                    
                    cart.splice(index, 1);
                    renderCart();
                }
            };
            
            const renderCart = () => {
                if (!cartSummaryElement) {
                    createCartSummaryHTML();
                }

                cartItemsList.innerHTML = '';
                let subtotal = 0;
                let finalTotal = 0;
                let discountAmount = 0;
                const itemCount = cart.length;

                if (itemCount === 0) {
                    cartItemsList.innerHTML = '<li>Nenhum servi√ßo avulso selecionado.</li>';
                    checkoutButton.disabled = true;
                } else {
                    cart.forEach(item => {
                        const li = document.createElement('li');
                        li.setAttribute('data-id', item.id); 
                        li.innerHTML = `
                            <span>${item.name}</span>
                            <div>
                                <strong>${formatToBRL(item.price)}</strong>
                                <button class="remove-item-btn" data-id="${item.id}" title="Remover item">&times;</button>
                            </div>
                        `;
                        cartItemsList.appendChild(li);
                        subtotal += item.price;
                    });
                    checkoutButton.disabled = false;
                    
                    document.querySelectorAll('.remove-item-btn').forEach(button => {
                        button.addEventListener('click', (event) => {
                            const itemId = parseInt(event.target.dataset.id);
                            removeItem(itemId);
                        });
                    });
                }
                
                if (itemCount >= 2) {
                    discountAmount = subtotal * DISCOUNT_RATE;
                    finalTotal = subtotal - discountAmount;
                } else {
                    finalTotal = subtotal;
                }
                
                let totalsHTML = '';
                if (itemCount > 0) {
                    if (discountAmount > 0) {
                        totalsHTML += `
                            <div class="cart-subtotal">
                                <span>Subtotal:</span>
                                <span>${formatToBRL(subtotal)}</span>
                            </div>
                            <div class="cart-discount">
                                <span>Desconto (5% em ${itemCount} itens):</span>
                                <span>-${formatToBRL(discountAmount)}</span>
                            </div>
                        `;
                    }
                }
                
                totalsHTML += `
                    <div id="cart-total">
                        <span>Total:</span>
                        <span id="total-price">${formatToBRL(finalTotal)}</span>
                    </div>
                `;
                
                cartSummaryElement.innerHTML = totalsHTML;

                cartCountSpan.textContent = itemCount;
                floatingCartIcon.style.display = 'flex';
            };

            const handleCheckboxChange = (event) => {
                const checkbox = event.target;
                const serviceName = checkbox.dataset.name;
                const servicePrice = formatPrice(checkbox.dataset.price);

                if (checkbox.checked) {
                    const serviceId = nextItemId++;
                    cart.push({
                        id: serviceId, 
                        name: serviceName,
                        price: servicePrice,
                        checkboxId: checkbox.id 
                    });
                    
                    checkbox.setAttribute('data-cart-id', serviceId); 

                    animateCart();
                } else {
                    const cartId = parseInt(checkbox.getAttribute('data-cart-id'));
                    const index = cart.findIndex(item => item.id === cartId);

                    if (index > -1) {
                         cart.splice(index, 1);
                         checkbox.removeAttribute('data-cart-id');
                    }
                }

                renderCart();
            };
            
            // FUN√á√ÉO ATUALIZADA: Removida a informa√ß√£o de acr√©scimo no cr√©dito
            const handleCheckout = () => {
                const finalTotalElement = document.getElementById('total-price');
                const finalTotal = formatPrice(finalTotalElement.textContent);
                
                // Vari√°vel totalCredito removida.

                const itemsList = cart.map(item => `- ${item.name} (${formatToBRL(item.price)})`).join('\n');
                
                let messageBody = `Ol√°, gostaria de agendar os seguintes servi√ßos para meu ve√≠culo ${currentCarType}:
\n${itemsList}\n`;

                if (cart.length >= 2) {
                    const subtotal = finalTotal / (1 - DISCOUNT_RATE);
                    const discountAmount = subtotal * DISCOUNT_RATE;
                    messageBody += `Subtotal: ${formatToBRL(subtotal)}\n`;
                    messageBody += `Desconto (5% por m√∫ltiplos itens): -${formatToBRL(discountAmount)}\n`;
                }

                // Linha de total simplificada, sem refer√™ncia a Dinheiro/Pix ou Cr√©dito.
                messageBody += `\nTotal: ${formatToBRL(finalTotal)}`;
                
                // A linha do Total Cr√©dito foi removida.
                
                messageBody += `\n\n*Favor confirmar a disponibilidade de hor√°rio.*`;
                
                const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(messageBody)}`;
                window.open(whatsappUrl, '_blank');
            };


            const generateServicesHTML = (data) => {
                const services = data.additional_services;
                let html = '';

                html += `
                    <section class="additional-services">
                        <h3>Servi√ßos Avulsos para ${currentCarType} (Monte seu Pedido)</h3>
                `;

                services.forEach(service => {
                    const priceValue = formatPrice(service.price);
                    const checkboxId = `${service.name.replace(/\s/g, '-')}-${currentCarType}`;

                    html += `
                        <div class="service-item">
                            <input type="checkbox" id="${checkboxId}"
                                data-name="${service.name} (${currentCarType})"
                                data-price="${priceValue}">
                            <div class="service-details">
                                <h4>${service.name}</h4>
                                <p>${service.description}</p>
                                <span class="price">Pre√ßo: ${service.price}</span>
                            </div>
                        </div>
                    `;
                });
                html += '</section>';
                
                return html;
            };
            
            const showServices = (carType) => {
                currentCarType = carType;
                carTypeTitle.textContent = `Servi√ßos para ${carType}`;
                
                if (!carData[carType]) {
                    servicesContent.innerHTML = `<p style="text-align: center; color: var(--primary-red);">Erro: Dados de servi√ßo para ${carType} n√£o encontrados.</p>`;
                    return;
                }
                
                servicesContent.innerHTML = generateServicesHTML(carData[carType]);

                carSelectionSection.style.display = 'none';
                servicesDisplaySection.style.display = 'block';

                const checkboxes = servicesContent.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.removeAttribute('data-cart-id'); 
                    checkbox.addEventListener('change', handleCheckboxChange);
                });
                
                if (!cartSummaryElement) {
                    createCartSummaryHTML();
                }

                cart = []; 
                nextItemId = 0;
                renderCart();
            };

            const backToSelection = () => {
                carSelectionSection.style.display = 'block';
                servicesDisplaySection.style.display = 'none';
                cart = []; 
                nextItemId = 0;
                renderCart();
                
                cartModalOverlay.classList.remove('active'); 
            };

            carTypeButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const carType = event.target.dataset.car;
                    showServices(carType);

                    carTypeButtons.forEach(btn => btn.classList.remove('active'));
                    event.target.classList.add('active');
                });
            });

            backButton.addEventListener('click', backToSelection);
            
            floatingCartIcon.addEventListener('click', toggleFloatingCart);

            createCartSummaryHTML();
            renderCart();
        });
    </script>
    
</body>
</html>



